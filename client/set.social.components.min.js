(function(){

  'use strict';
  
  angular
    .module('set.social.components', []);

})();

(function() {

  'use strict';

  angular.module('set.social.components')
    .controller('containerController', ContainerController);

  ContainerController.$inject = ['$rootScope'];

  function ContainerController($rootScope) {

    var vm = this;
    vm.$onInit = onInit;
    vm.isOpenModal = false;
    vm.changeIsOpenModal =  changeIsOpenModal;

    function changeIsOpenModal() {
      vm.isOpenModal = !vm.isOpenModal;
    }

    function onInit() {
      vm.configChat = {
        "name"  : "Social Chat",
        "class" : "chat-icon",
        "counter": 0
      };
    };
  }
})();
(function() {
  'use strict';

  angular.module('set.social.components')
    .controller('indicatorController', IndicatorController);

  IndicatorController.inject = ['$rootScope', '$timeout'];

  function IndicatorController($rootScope, $timeout) {

    var vm = this;
    vm.$onInit = onInit;
    vm.click = click;

    function onInit() {
      if (vm.config) {
        vm.class    = vm.config.class;
        vm.name     = vm.config.name;
        vm.counter  = vm.config.counter;
       }
      // vm.notificationCounter();
    };

    function click() {
      vm.onOpen()
    };

    vm.notificationCounter = function () {
      $rootScope.$on('notification-counter', function (event, data) {
        /*$timeout(function () {
          angular.element(document.querySelector('#indicator')).triggerHandler('click');
          // angular.element('#indicator').triggerHandler('click');
        }, 0);*/
        vm.counter = data;
      });
    };
  }
})();
(function(){
  'use strict';
  /**
  *  Module social component
  *
  * Description Componente related to avatar of Lucy
  */
  angular.module('set.social.components')
    .controller('lucyController', LucyController);

  LucyController.$inject = ['$log'];

  function LucyController($log){

  }
})();

(function() {
  'use strict';
  var app = angular.module('set.social.components');
  app.controller('navigatorController', NavigatorController);

  NavigatorController.$inject = [];
  function NavigatorController() {
    var vm = this;
    var userSend = '';
    var counterLast = 0;
    vm.$onInit = onInit;
    vm.click = click;
    vm.close = close;


    function onInit() {
      vm.counter  = 0;
      // vm.notificationCounter();
      // vm.userId = sessionService.getUserStorage().id;
    };

    function close() {
      vm.onClose();
    };

    function click() {
      vm.counter = vm.counter +1;
    };

    vm.notificationCounter = function () {
      $rootScope.$on('chat-edit-message-response-position-ws-counter-byusers', function (event, data) {
        var listParticipants = data.body.content;
        if(listParticipants.countUnread === undefined){
          listParticipants.forEach(function(element) {
            if(element.participant.userId === vm.userId){
              vm.counter = element.countUnread;
              //break;
            }
          });

        }else{
          userSend = listParticipants.userId;
          if(vm.userId === userSend && userSend !== ''){
            vm.counter = listParticipants.countUnread;
          }

        }

      });
      $rootScope.$on('chat-edit-message-response-position-ws-counter-user', function (event, data) {
        userSend = data.body.content.messages.sender.userId;
        if(vm.userId !== userSend && userSend !== ''){
          vm.counter = counterLast;
        }
      });
      $rootScope.$on('chat-edit-message-response-position-ws-counter', function (event, data) {
        console.log('POSTION:',data.body.content.countUnread);
        counterLast = data.body.content.countUnread;
      });
    };
  }
})();

(function(){
  'use strict';

  var component = {
    template:'<div ng-animate="\'animate\'" ng-if="$ctrl.isOpenModal" class="row margin-child set-container-box"><set-lucy class="col-md-2"></set-lucy><div class="col-md-10 set-container-box__services"><div class="row margin-child"><set-navigator resource="$ctrl.resource" on-close="$ctrl.changeIsOpenModal()"></set-navigator></div><div class="row margin-child"><set-chat resource="$ctrl.resource" resource-name="$ctrl.resourceName"></set-chat></div></div></div><div ng-animate="\'animate\'" ng-if="!$ctrl.isOpenModal"><set-indicator config="$ctrl.configChat" resource="$ctrl.resource" on-open="$ctrl.changeIsOpenModal()"></set-indicator></div>',
    controller: 'containerController',
    bindings: {
      resource      : '<'
    }
  }

  angular.module('set.social.components')
    .component('setContainer', component);

})();

(function() {

  'use strict';
  /**
   * @ngdoc function
   * @name modal.component
   * @description
   * Component Indicator
   */

  var component = {
    template:'<div class="indicator"><a ng-click="$ctrl.click()" id="indicator"><div class="{{$ctrl.class}}"></div><span class="indicator-counter">{{$ctrl.counter}}</span></a></div>',
    controller: 'indicatorController',
    bindings: {
      config: "<",
      resource: "<",
      onOpen: '&'
    }
  }

  angular.module('set.social.components')
    .component('setIndicator', component);

})();
(function(){
  'use strict';
  /**
  *  Module social component
  *
  * Description Componente related to avatar of Lucy
  */
  var component = {
    template:'<div class="lucy-region"><div class="lucy-img"></div></div>',
    controller: 'lucyController'
  }

  angular.module('set.social.components')
    .component('setLucy', component);

})();

(function(){
  'use strict';
  var component = {
    bindings: {
      resource : '<',
      onClose: '&'
    },
    template:'<div class="nav-content"><div class="col-md-10 corner-left"><a ui-sref="set-chat-lucy" class="color-icon"><i class="fa fa-question-circle fa-lg" aria-hidden="true"></i></a> <a ui-sref="set-share" class="color-icon"><i class="fa fa-share-alt fa-lg" aria-hidden="true"></i></a> <a ui-sref="set-attachment" class="color-icon"><i class="fa fa-paperclip fa-lg" aria-hidden="true"></i></a> <a ui-sref="set-document" class="color-icon"><i class="fa fa-sticky-note fa-lg" aria-hidden="true"></i></a> <a ui-sref="set-chat" class="color-icon"><i class="fa fa-comment fa-lg" aria-hidden="true"></i> <span ng-if="$ctrl.counter > 0" class="badge set-badge__counter" ng-click="$ctrl.click()">{{$ctrl.counter}}</span></a> <a ui-sref="set-info" class="color-icon"><i class="fa fa-info-circle fa-lg" aria-hidden="true"></i></a></div><div class="col-md-2 corner-right"><a href="javascript:void(0);" ng-click="$ctrl.close()" class="color-icon color-icon-remove"><i class="fa fa-times fa-lg" aria-hidden="true"></i></a></div></div>',
    controller: 'navigatorController'
  }

  angular.module('set.social.components')
    .component('setNavigator', component);

})();
